generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model fields {
  id           Int            @id(map: "fields_pk") @default(autoincrement())
  description  String?        @db.VarChar
  status       Boolean        @default(true)
  reservations reservations[]
}

model reservation_statuses {
  id           Int            @id(map: "reservation_statuses_pk") @default(autoincrement())
  description  String?        @db.VarChar
  reservations reservations[]
}

model reservations {
  id                   BigInt                @id(map: "reservations_pk") @default(autoincrement())
  date                 DateTime?             @db.Date
  start_time           DateTime?             @db.Time(6)
  end_time             DateTime?             @db.Time(6)
  id_field             Int?
  id_user              BigInt?
  notes                String?               @db.VarChar
  room                 String?               @db.VarChar
  mixed                Boolean?              @default(false)
  id_status            Int?                  @default(1)
  user_not_registered  String?               @db.VarChar
  fields               fields?               @relation(fields: [id_field], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "reservations_fields_fk")
  reservation_statuses reservation_statuses? @relation(fields: [id_status], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "reservations_reservation_statuses_fk")
  users                users?                @relation(fields: [id_user], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "reservations_users_fk")
}

model roles {
  id    Int     @id(map: "roles_pk") @default(autoincrement()) @db.SmallInt
  macro String? @db.VarChar
  users users[]
}

model users {
  id           BigInt         @id(map: "users_pk") @default(autoincrement())
  name         String?        @db.VarChar
  surname      String?        @db.VarChar
  nickname     String?        @db.VarChar
  telephone    String?        @db.VarChar
  email        String?        @unique(map: "users_unique") @db.VarChar
  password     String?        @db.VarChar
  role_id      Int?           @db.SmallInt
  reservations reservations[]
  roles        roles?         @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_roles_fk")
  wallets      wallets[]
}

model wallet_actions {
  id          Int           @id(map: "wallet_actions_pk") @default(autoincrement()) @db.SmallInt
  description String?       @db.VarChar
  wallets_log wallets_log[]
}

model wallets {
  id          BigInt        @id(map: "wallets_pk") @default(autoincrement())
  balance     Decimal?      @db.Decimal(12, 2)
  id_user     BigInt?
  users       users?        @relation(fields: [id_user], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "wallets_users_fk")
  wallets_log wallets_log[]
}

model wallets_log {
  id             BigInt          @id(map: "wallets_log_pk") @default(autoincrement())
  event_time     DateTime?       @db.Timestamptz(6)
  id_wallet      BigInt?
  id_action      Int?            @db.SmallInt
  amount         Decimal?        @db.Decimal(12, 2)
  wallet_actions wallet_actions? @relation(fields: [id_action], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "wallets_log_wallet_actions_fk")
  wallets        wallets?        @relation(fields: [id_wallet], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "wallets_log_wallets_fk")
}

// START VIEWS
model users_wallets {
  user_id   Int    @id
  name      String
  surname   String
  nickname  String
  email     String
  telephone String
  wallet_id Int?   // può essere null perché è un LEFT JOIN
  balance   Float? // può essere null perché è un LEFT JOIN

  @@map("users_wallets")
}


model view_reservations {
  id          Int      @id
  date        DateTime
  start_time  DateTime
  end_time    DateTime
  room        String?
  notes       String? 
  user_not_registered   String?
  name        String?
  surname     String?
  telephone   String?
  email       String?
  nickname    String?
  description String?
  mixed       Boolean?

  @@map("view_reservations")
}

// END VIEWS
